sap.ui.define(["sap/ui/core/UIComponent","sap/ui/Device","com/sap/bmi/scp/apps/complaintforms/model/models"],function(e,t,s){"use strict";return e.extend("com.sap.bmi.scp.apps.complaintforms.Component",{metadata:{manifest:"json"},init:function(){e.prototype.init.apply(this,arguments);this.getRouter().initialize();this.setModel(s.createDeviceModel(),"device");var t="";var o="";var a="";try{t=this.getComponentData().startupParameters;o=t.taskModel;a=o.getData().InstanceID;var r=new sap.ui.model.json.JSONModel("/bpmworkflowruntime/v1/task-instances/"+a+"/context");r.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);this.setModel(r);var i=this;r.attachRequestCompleted(function(){var e=r.getData();i.getModel("oLocalJsonModel").setProperty("/Arbitrated",this.getData().Arbitrated==="undefined"?"":this.getData().Arbitrated);i.getModel("oLocalJsonModel").setProperty("/CurrentStatus",this.getData().StatusUpdate.SettlementTrackingUpdate.ApprovalList.CurrentStatus==="undefined"?"":this.getData().StatusUpdate.SettlementTrackingUpdate.ApprovalList.CurrentStatus);i.getModel("oLocalJsonModel").setProperty("/ApprovalLevel",this.getData().ApprovalLevel==="undefined"?"":this.getData().ApprovalLevel);i.getModel("oLocalJsonModel").setProperty("/ApprovalList",this.getData().StatusUpdate.SettlementTrackingUpdate.ApprovalList==="undefined"?"":this.getData().StatusUpdate.SettlementTrackingUpdate.ApprovalList);i.getModel("oLocalJsonModel").setProperty("/approver_result",this.getData().approver_result==="undefined"?"":this.getData().approver_result);i.getModel("oLocalJsonModel").setProperty("/ComplaintDesc",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Name==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Name);i.getModel("oLocalJsonModel").setProperty("/ComplaintId",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ID==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ID);i.getModel("oLocalJsonModel").setProperty("/Complainturl",this.getData().Complainturl==="undefined"?"":this.getData().Complainturl);i.getModel("oLocalJsonModel").setProperty("/ComplaintDesc",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Name==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Name);i.getModel("oLocalJsonModel").setProperty("/Account",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.PartyID==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.PartyID);i.getModel("oLocalJsonModel").setProperty("/AccountName",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.AddressSnapshotDisplayName.AddressSnapshotDisplayName.FormattedName==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.AddressSnapshotDisplayName.AddressSnapshotDisplayName.FormattedName);i.getModel("oLocalJsonModel").setProperty("/ComplaintCategory",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceCategoryID==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceCategoryID);i.getModel("oLocalJsonModel").setProperty("/ComplaintReason",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ZComplaintReason_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ZComplaintReason_KUT);i.getModel("oLocalJsonModel").setProperty("/TotalCost",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_CostAllocationcontent_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_CostAllocationcontent_KUT);i.getModel("oLocalJsonModel").setProperty("/TotalCostCurrency",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_CostAllocationcurrencyCode_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_CostAllocationcurrencyCode_KUT);i.getModel("oLocalJsonModel").setProperty("/CostAllocation",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ZCostAllocation_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ZCostAllocation_KUT);i.getModel("oLocalJsonModel").setProperty("/ImmediateSettlement",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_ImmediateSettlement_Header_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_ImmediateSettlement_Header_KUT);i.getModel("oLocalJsonModel").setProperty("/CostSplit",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_CostSplit_New_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_CostSplit_New_KUT);i.getModel("oLocalJsonModel").setProperty("/CustomerCountry",this.getData().Messages.Message2.ServiceRequestPartyCollection.ServiceRequestParty.CountryCode==="undefined"?"":this.getData().Messages.Message2.ServiceRequestPartyCollection.ServiceRequestParty.CountryCode);i.getModel("oLocalJsonModel").setProperty("/SettlementReference",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Settlementwithreference_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Settlementwithreference_KUT);i.getModel("oLocalJsonModel").setProperty("/Invoice_Ref_ID",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.RefInvoiceID_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.RefInvoiceID_KUT);i.getModel("oLocalJsonModel").setProperty("/Delivery_Ref_ID",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_RefDeliveryID_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_RefDeliveryID_KUT);i.getModel("oLocalJsonModel").setProperty("/Other_Ref_Reason",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_OtherReferenceReason_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_OtherReferenceReason_KUT);i.getModel("oLocalJsonModel").setProperty("/ComplaintsStatus",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestUserLifeCycleStatusCode==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestUserLifeCycleStatusCode);i.getModel("oLocalJsonModel").setProperty("/LineItem",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.ID==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.ID);i.getModel("oLocalJsonModel").setProperty("/Product",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.ProductID==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.ProductID);i.getModel("oLocalJsonModel").setProperty("/ProductDescription",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.Description==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.Description);i.getModel("oLocalJsonModel").setProperty("/SettlementMethod",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.UserServiceTransactionProcessingTypeCode==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.UserServiceTransactionProcessingTypeCode);i.getModel("oLocalJsonModel").setProperty("/Quantity",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.RequestedQuantity==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.RequestedQuantity);i.getModel("oLocalJsonModel").setProperty("/SettlementAmount",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.Z_SettlementAmountcontent_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.Z_SettlementAmountcontent_KUT);i.getModel("oLocalJsonModel").setProperty("/PrincipalPlant",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.ZPlantCode_SDK==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.ServiceRequestItem.ServiceRequestItem.ZPlantCode_SDK);i.getModel("oLocalJsonModel").setProperty("/Comments",this.getData().Comments==="undefined"?"":this.getData().Comments);i.getModel("oLocalJsonModel").setProperty("/CustomerBMIType",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Case_BMIType1_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Case_BMIType1_KUT);i.getModel("oLocalJsonModel").setProperty("/CustomerBMIType2",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Case_BMIType2_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Case_BMIType2_KUT);i.getModel("oLocalJsonModel").setProperty("/CreationDateTime",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.CreationDateTime==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.CreationDateTime);i.getModel("oLocalJsonModel").setProperty("/ComplaintCreatedBy",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Createdby.Createdby.FormattedName==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Createdby.Createdby.FormattedName);i.getModel("oLocalJsonModel").setProperty("/HighRisk",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.HighRisk_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.HighRisk_KUT);i.getModel("oLocalJsonModel").setProperty("/IsJustified",this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Settlementwithreference_KUT==="undefined"?"":this.getData().Messages.Message1.ServiceRequestCollection.ServiceRequest.Z_Settlementwithreference_KUT);i.getModel("oLocalJsonModel").setProperty("/ContactID",this.getData().ContactID==="undefined"?"":this.getData().ContactID);i.getModel("oLocalJsonModel").setProperty("/ContactName",this.getData().ContactName==="undefined"?"":this.getData().ContactName);var s="Approve";var o="ApprovedN";var n={sBtnTxt:s,onBtnPressed:function(e){var t=i.getModel();t.refresh(true);i._triggerComplete(a,o,jQuery.proxy(i._refreshTask,i))}};t.inboxAPI.addAction({action:n.sBtnTxt,label:n.sBtnTxt,type:"Accept"},n.onBtnPressed);var l=this.getData().ButtonText.Result[0].ButtonText.ButtonText;var c;c="Rejected";if(l==="Arbitrate"){c="Arbitrate"}var d={sBtnTxt:l,taskStatus:c,onBtnPressed:function(e){var t=i.getModel();t.refresh(true);i._triggerComplete(a,c,jQuery.proxy(i._refreshTask,i))}};t.inboxAPI.addAction({action:d.sBtnTxt,label:d.sBtnTxt,type:"Reject"},d.onBtnPressed)})}catch(e){return}},_triggerComplete:function(e,t,s){var o=new sap.m.BusyDialog;o.open();o.setBusyIndicatorDelay(4e3);if(this.getModel("oLocalJsonModel").getProperty("/ComplaintApprovalReason")===undefined||this.getModel("oLocalJsonModel").getProperty("/ComplaintApprovalReason")===""){o.close();sap.m.MessageBox.error("Enter comment");return}var a=this.byId("ApproverScreen").getId();var r=this.getModel("oLocalJsonModel").getProperty("/CurrentStatus");var i=this.getModel("oLocalJsonModel").getProperty("/ApprovalLevel");var n;var l={};n=l;var c=new Date;var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd.MM.yyyy HH:mm"});var u=new Date(c);var g=d.format(u);var v=this.getModel("oLocalJsonModel").getProperty("/ComplaintsStatus");if(t==="ApprovedN"){var M=this.getModel("oLocalJsonModel").getProperty("/ApprovalList");var p,S;var R=i-1;M[R].CurrentStatus="Approved";M[R].LastUpdated=g;this.getModel("oLocalJsonModel").setProperty("/ApprovalList",M);var C=this.byId(a+"--"+"IdInpCostAllocation").getProperty("selectedKey");var m=this.getModel("oLocalJsonModel").getProperty("/ComplaintsStatus");var q=++i;var r="Approved";var D=g;n='{ "status":"COMPLETED","context": {"approvedorreject": "'+t+'","Comments" : "'+this.getModel("oLocalJsonModel").getData().ComplaintApprovalReason+'","Arbitrated":"'+"Approved"+'","ApprovalLevel": "'+q+'","CurrentStatus": "'+r+'","LastUpdated": "'+g+'","ApprovalLevel1": "'+R+'","StatusUpdate":{"Complaintsstatus":"'+m+'","CostAllocation":"'+C+'"},"Messages":{"Message1":{"ServiceRequestCollection":{"ServiceRequest":{"ZCostAllocation_KUT":"'+C+'"}}}} }}'}else if(t==="Arbitrate"){var R=i-1;if(i==="1"){this.byId(a+"--"+"IdInpCostAllocation").setEditable(true);this.byId(a+"--"+"IdInpComments").setEditable(true);o.close();return}else{q=--i;M=this.getModel("oLocalJsonModel").getData().ApprovalList;M[R].CurrentStatus="Arbitrate";M[R].LastUpdated=g;var c=new Date;var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd.MM.yyyy HH:mm"});var u=new Date(c);g=d.format(u);r="Arbitrate";this.getModel("oLocalJsonModel").setProperty("/ApprovalList",M);if(v==="Z7"){v="Y2"}else{v="Y7"}n='{ "status":"COMPLETED","context": {"approvedorreject": "'+t+'","Comments" : "'+this.getModel("oLocalJsonModel").getData().ComplaintApprovalReason+'","Arbitrated":"'+"Arbitrate"+'","ApprovalLevel": "'+q+'","CurrentStatus": "'+r+'","LastUpdated": "'+g+'","ApprovalLevel1": "'+R+'","StatusUpdate":{"Complaintsstatus": "'+v+'"}} }'}}else if(t==="Rejected"){q=i;r="Rejected by Level "+q;M=this.getModel("oLocalJsonModel").getData().ApprovalList;var R=i-1;M[R].CurrentStatus="Rejected";M[R].LastUpdated=g;this.getModel("oLocalJsonModel").setProperty("/ApprovalList",M);r="Rejected";c=new Date;var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd/MM/yyyy HH:mm"});var u=new Date(c);var g=d.format(u);n='{ "status":"COMPLETED","context": {"approvedorreject": "'+t+'","Comments" : "'+this.getModel("oLocalJsonModel").getData().ComplaintApprovalReason+'","Arbitrated":"'+"Rejected"+'","ApprovalLevel": "'+q+'","CurrentStatus": "'+r+'","LastUpdated": "'+g+'","ApprovalLevel1": "'+R+'" }}'}else{return}var h=this._fetchToken();$.ajax({url:"/bpmworkflowruntime/v1/task-instances/"+e,method:"PATCH",contentType:"application/json",data:n,headers:{"X-CSRF-Token":h},success:s});this.byId(a+"--"+"IdInpComments").setEditable(false);this.byId(a+"--"+"IdInpCostAllocation").setEditable(false);o.close()},_refreshTask:function(){var e=this.getComponentData().startupParameters.taskModel.getData().InstanceID;this.getComponentData().startupParameters.inboxAPI.updateTask("NA",e)},_fetchToken:function(){var e;$.ajax({url:"/bpmworkflowruntime/v1/xsrf-token",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(t,s,o){e=o.getResponseHeader("X-CSRF-Token")},error:function(e,t,s){this.onErrorCall()}.bind(this)});return e}})});